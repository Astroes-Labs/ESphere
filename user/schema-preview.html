<?php 
    $endpoint = '../vendor/php/view.php'; 
    include_once $endpoint; 
?>
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="csrf-token" content="3Hb4beEaVqFusynfhpb2vPyJoshoYMSyJjPiApgC">
    <meta name="keywords" content="<?php echo WEBSITE_NAME; ?>">
    <meta name="description" content="<?php echo WEBSITE_NAME; ?>">
    <link rel="canonical" href="../user/schema-preview/1" />
    <link rel="shortcut icon" href="../assets/global/images/8asAPVg73gU9Kr32Z2dv.png" type="image/x-icon" />

    <link rel="icon" href="../assets/global/images/8asAPVg73gU9Kr32Z2dv.png" type="image/x-icon" />
    <link rel="stylesheet" href="../assets/global/css/fontawesome.min.css" />
    <link rel="stylesheet" href="../assets/frontend/css/vendor/bootstrap.min.css" />
    <link rel="stylesheet" href="../assets/frontend/css/animate.css" />
    <link rel="stylesheet" href="../assets/frontend/css/owl.carousel.min.css" />
    <link rel="stylesheet" href="../assets/global/css/nice-select.css" />
    <link rel="stylesheet" href="../assets/global/css/datatables.min.css" />
    <link rel="stylesheet" href="../assets/global/css/simple-notify.min.css" />
    <link rel="stylesheet" type="text/css" href="../assets/vendor/mckenziearts/laravel-notify/css/notify.css" />
    <link rel="stylesheet" href="../assets/global/css/custom.css" />
    <link rel="stylesheet" href="../assets/frontend/css/magnific-popup.css" />
    <link rel="stylesheet" href="../assets/frontend/css/styles.css?var=2.1" />
  <!-- Include Toastr CSS -->
  <link rel="stylesheet" href="../assets/frontend/css/toastr.min.css">

    <style>
        //The Custom CSS will be added on the site head tag 
        .site-head-tag {
            margin: 0;
            padding: 0;
        }
    </style>

    <title>
        <?php echo WEBSITE_NAME; ?> - Schema Preview
    </title>


</head>

<body class="dark-theme">
    <script>
        var notify = {
            timeout: "5000",
        }
    </script>
    <!--Full Layout-->
    <div class="panel-layout">
        <!--Header-->
        <div class="panel-header">
            <div class="logo">
                <a href="..">
                    <img class="logo-unfold" src="../assets/global/images/fQqFMZn3e0VAvI05KvFR.png" alt="Logo" />
                    <img class="logo-fold" src="../assets/global/images/fQqFMZn3e0VAvI05KvFR.png" alt="Logo" />
                </a>
            </div>
            <div class="nav-wrap">
                <div class="nav-left">
                    <button class="sidebar-toggle">
                        <i class="anticon anticon-arrow-left"></i>
                    </button>
                    <div class="mob-logo">
                        <a href="..">
                            <img src="../assets/global/images/fQqFMZn3e0VAvI05KvFR.png" alt="Site Name" />
                        </a>
                    </div>
                </div>
                <div class="nav-right">
                    <div class="single-nav-right">

                        <div class="single-right">
                            <div class="color-switcher">
                                <i icon-name="moon" class="dark-icon" data-mode="dark"></i>
                                <i icon-name="sun" class="light-icon" data-mode="light"></i>
                            </div>
                        </div>


                        <?php echo $_SESSION['noticeDropDown']; ?>


                        <div class="single-right">
                            <select name="language" id="" class="site-nice-select"
                                onchange="window.location.href=this.options[this.selectedIndex].value;">
                                <option value="../language-update?name=en" selected>English</option>
                                <option value="../language-update?name=es">Spanish</option>
                                <option value="../language-update?name=fr">Franch</option>
                            </select>
                        </div>
                       
                        <div class="single-right">
                            <button type="button" class="item" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="anticon anticon-user"></i>
                            </button>
                            <?php echo $navMini; ?>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--/Header-->

        <div class="desktop-screen-show">
            <div class="side-nav ">
                <div class="side-wallet-box default-wallet mb-0">
                    <?php echo $balanceHolder; ?>
                </div>
                <div class="side-nav-inside">
                    <?php echo $navMenu; ?>
                </div>
            </div>
        </div>


        <div class="page-container">
            <div class="main-content">
                <div class="section-gap">
                    <div class="container-fluid">

                        <div class="row desktop-screen-show">
                            <div class="col">
                               <?php echo $_SESSION['kycAlert']; ?>
                            </div>
                        </div>
                        <div class="row mobile-screen-show">
                            <div class="col-12">
                               <?php echo $_SESSION['kycAlertMobile']; ?>
                            </div>
                        </div>
                        <!--Page Content-->
                        <div class="row justify-content-center">
                            <div class="col-xl-10 col-lg-12 col-md-12">
                                <div class="site-card">
                                    <div class="site-card-header">
                                        <h3 class="title">Review and Confirm Investment</h3>
                                    </div>
                                    <div class="site-card-body">
                                        <form action="../user/invest-now" method="post" enctype="multipart/form-data"
                                            id="schemaPreviewForm">
                                            <input type="hidden" name="_token"
                                                value="3Hb4beEaVqFusynfhpb2vPyJoshoYMSyJjPiApgC">
                                            <div class="progress-steps-form">
                                                <div class="transaction-list table-responsive">
                                                    <table class="table preview-table">
                                                        <tbody>
                                                            <tr>
                                                                <td><strong>Select Schema:</strong></td>
                                                                <td>
                                                                    <div class="input-group mb-0">
                                                                        <select class="site-nice-select"
                                                                            aria-label="Default select example"
                                                                            id="select-schema" name="schema_id"
                                                                            required>
                                                                            <?php echo $_SESSION['schemasFormOptions']; ?>
                                                                        </select>
                                                                    </div>
                                                                </td>
                                                            </tr>

                                                            <tr>
                                                                <td><strong>Profit Holiday:</strong></td>
                                                                <td id="holiday">
                                                                    No </td>
                                                            </tr>

                                                            <tr>
                                                                <td><strong>Amount:</strong></td>
                                                                <td id="amount">
                                                                    Minimum
                                                                    <?php echo $_SESSION['schemaPreview']['min'];?> USD
                                                                    - Maximum
                                                                    <?php echo $_SESSION['schemaPreview']['max'];?> USD
                                                                </td>
                                                            </tr>

                                                            <tr>
                                                                <td><strong>Enter Amount:</strong></td>
                                                                <td>
                                                                    <div class="input-group mb-0">
                                                                        <input type="text" class="form-control"
                                                                            placeholder="Enter Amount"
                                                                            oninput="this.value = validateDouble(this.value)"
                                                                            aria-label="Amount" name="invest_amount"
                                                                            id="enter-amount"
                                                                            aria-describedby="basic-addon1" required>
                                                                        <span class="input-group-text"
                                                                            id="basic-addon1">USD</span>
                                                                    </div>
                                                                </td>
                                                            </tr>

                                                            <tr>
                                                                <td><strong>Select Wallet:</strong></td>
                                                                <td>
                                                                    <div class="input-group mb-0">
                                                                        <select class="site-nice-select"
                                                                            aria-label="Default select example"
                                                                            name="wallet" required id="selectWallet">
                                                                            <option value="main">Main Wallet (
                                                                                <?php echo $_SESSION['balance']; ?> USD
                                                                                )
                                                                            </option>
                                                                            <option value="profit">Profit Wallet (
                                                                                <?php echo $_SESSION['profit']; ?> USD
                                                                                )
                                                                            </option>
                                                                            <option value="gateway">Direct Gateway
                                                                            </option>
                                                                        </select>
                                                                    </div>

                                                                </td>
                                                            </tr>

                                                            <tr class="gatewaySelect">

                                                            </tr>

                                                            <tr>
                                                                <td colspan="2">
                                                                    <div class="row manual-row"></div>
                                                                </td>
                                                            </tr>

                                                            <tr>
                                                                <td><strong>Return of Interest:</strong></td>
                                                                <td id="return-interest">
                                                                    <?php echo $_SESSION['schemaPreview']['roi'];?>%
                                                                    (Daily)
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td><strong>Number of Period:</strong></td>
                                                                <td id="number-period">
                                                                    <?php echo $_SESSION['schemaPreview']['period'];?>
                                                                    Times
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td><strong>Capital Back:</strong></td>
                                                                <td id="capital_back">
                                                                    <?php echo $_SESSION['schemaPreview']['capital_back'];?>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td><strong>Total Investment Amount:</strong></td>
                                                                <td><span id="total-amount"> 0</span> USD
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                                <div class="button">
                                                    <button type="submit" class="site-btn primary-btn me-3">
                                                        <i class="anticon anticon-check"></i>Invest Now
                                                    </button>
                                                    <a href="../user/schemas" class="site-btn black-btn">
                                                        <i class="anticon anticon-stop"></i>Cancel
                                                    </a>
                                                </div>
                                            </div>
                                        </form>

                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--Page Content-->
                    </div>
                </div>
            </div>
        </div>



        <!-- Show in 575px in Mobile Screen -->
        <div class="mobile-screen-show">
            <?php echo $navMobile; ?>
        </div>

        <!-- Show in 575px in Mobile Screen End -->

        <!-- Automatic Popup -->

        <!-- /Automatic Popup End -->
    </div>
    <!--/Full Layout-->

    <script src="../assets/global/js/jquery.min.js"></script>
      <!-- Include Toastr JS -->
    <script src="../home/static/auth/js/toastr.min.js"></script>
    <script src="../assets/global/js/jquery-migrate.js"></script>

    <script src="../assets/frontend/js/bootstrap.bundle.min.js"></script>
    <script src="../assets/frontend/js/scrollUp.min.js"></script>

    <script src="../assets/frontend/js/owl.carousel.min.js"></script>
    <script src="../assets/global/js/waypoints.min.js"></script>
    <script src="../assets/frontend/js/jquery.counterup.min.js"></script>
    <script src="../assets/global/js/jquery.nice-select.min.js"></script>
    <script src="../assets/global/js/lucide.min.js"></script>
    <script src="../assets/frontend/js/magnific-popup.min.js"></script>
    <script src="../assets/frontend/js/aos.js"></script>
    <script src="../assets/global/js/datatables.min.js" type="text/javascript" charset="utf8"></script>
    <script src="../assets/global/js/simple-notify.min.js"></script>
    <script src="../assets/frontend/js/main.js?var=5"></script>
    <script src="../assets/frontend/js/cookie.js"></script>
    <script src="../assets/global/js/custom.js?var=5"></script>
    <script src="../assets/global/js/pusher.min.js"></script>
    <script>
            (function ($) {
                'use strict';

                let pusherAppKey = "";
                let pusherAppCluster = "mt1";
                let soundUrl = "../notification-tune";

                var notification = new Pusher(pusherAppKey, {
                    encrypted: true,
                    cluster: pusherAppCluster,
                });
                var channel = notification.subscribe('user-notification109');
                channel.bind('notification-event', function (result) {
                    playSound();
                    latestNotification();
                    notifyToast(result);
                });

                function latestNotification() {
                    $.get('../user/latest-notification', function (data) {
                        $('.user-notifications109').html(data);
                    })
                }

                function notifyToast(data) {
                    new Notify({
                        status: 'info',
                        title: data.data.title,
                        text: data.data.notice,
                        effect: 'slide',
                        speed: 300,
                        customClass: '',
                        customIcon: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-megaphone"><path d="m3 11 18-5v12L3 14v-3z"></path><path d="M11.6 16.8a3 3 0 1 1-5.8-1.6"></path></svg>',
                        showIcon: true,
                        showCloseButton: true,
                        autoclose: true,
                        autotimeout: 9000,
                        gap: 20,
                        distance: 20,
                        type: 1,
                        position: 'right bottom',
                        customWrapper: '<div><a href="' + data.data.action_url + '" class="learn-more-link">Explore<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" icon-name="external-link" class="lucide lucide-external-link"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" x2="21" y1="14" y2="3"></line></svg></a></div>',
                    })

                }

                function playSound() {
                    $.get(soundUrl, function (data) {
                        var audio = new Audio(data);
                        audio.play();
                        audio.muted = false;
                    });
                }



            })(jQuery);
    </script>
    <script>
        (function ($) {
            'use strict';
            // To top
            $.scrollUp({
                scrollText: '<i class="fas fa-caret-up"></i>',
                easingType: 'linear',
                scrollSpeed: 500,
                animation: 'fade'
            });
        })(jQuery);
    </script>

    <script type="text/javascript" src="../assets/vendor/mckenziearts/laravel-notify/js/notify.js"></script>

    <script>
        $(document).ready(function () {
            $('#schemaPreviewForm')[0].reset();

            $('#schemaPreviewForm').submit(function (e) {
                e.preventDefault(); 
                var formData = new FormData(this);
                var selectWallet = $('#selectWallet').val();
                if(selectWallet === "gateway"){

                    var gatewaySelect = $('#gatewaySelect').val();
                    if(gatewaySelect.trim() !== ''){
                        submitForm(formData);

                    }else{
                        toastr.error('Please Select a Payment Method.');
                    }
                }else{
                    submitForm(formData);
                }
            });

        });

        function submitForm(formData){
             $.ajax({
                url: endpoint,//$(this).attr('action'),
                type: "POST",//$(this).attr('method'),
                data: formData,
                processData: false,
                contentType: false,
                success: function (result) {
                    if (result.message === 'success') {
                        $('#schemaPreviewForm')[0].reset();
                        toastr.success('Processing...');
                        setTimeout(function () {
                            window.location.href = "invest-logs.html";
                        },2000);
                    }

                    if (result.message === 'IB') {
                        $('#schemaPreviewForm')[0].reset();
                        toastr.error('Insufficient Balance');
                    }
                    console.log("Success");
                    
                },
                error: function (xhr, status, error) {
                    // Handle errors, e.g., show error message
                    console.log('Error: ' + error);
                }
            });
        }
        $("#select-schema").on('change', function (e) {
            "use strict";
            e.preventDefault();
            var id = $(this).val();

            var invest_amount = $("#enter-amount");
            //invest_amount.val('');
            invest_amount.attr('readonly', false);

            
            $.ajax({
                url: endpoint,
                type: "POST",
                dataType: "json",
                data: {
                    schemaId: id,
                },
                success: function (data) {
                    var result = data.credentials;
                    $('#amount').html(result.amount_range);
                    $('#holiday').html(result.holiday);
                    $('#return-interest').html(result.return_interest);
                    $('#number-period').html(result.number_period);
                    $('#capital_back').html(result.capital_back);

                    if (result.invest_amount > 0) {
                        //invest_amount.val(result.invest_amount);
                        invest_amount.attr('readonly', true);
                    }
                },
                error: function (xhr, status, error) {
                    // Handle errors here
                    console.error(xhr.responseText + " GO");
                }
            });
        });
        $("#enter-amount").on('keyup', function (e) {
            "use strict";
            e.preventDefault();
            var amount = $(this).val();
            $("#total-amount").html(amount);
        })

        $("#selectWallet").on('change', function (e) {
            "use strict";
            $('.gatewaySelect').empty();
            $('.manual-row').empty();
            var wallet = $(this).val();
            if (wallet === 'gateway') {
                $.ajax({
                    url: endpoint,
                    type: "POST",
                    dataType: "json",
                    data: {
                        gateway: "gateway",
                    },
                    success: function (data) {
                        $('.gatewaySelect').empty();
                        $('.gatewaySelect').append(data);
                        $('select').niceSelect();
                    },
                    error: function (xhr, status, error) {
                        // Handle errors here
                        console.error(xhr.responseText + " GO");
                    }
                });
            }

        });
        $('body').on('change', '#gatewaySelect', function (e) {
            "use strict"
            e.preventDefault();
                $('.manual-row').empty();

                var code = $(this).val();
                if(code !== ''){
                    $.ajax({
                        url: endpoint,
                        type: "POST",
                        dataType: "json",
                        data: {
                            gatewayCode: code,
                        },
                        success: function (data) {
                            if (data.credentials !== undefined) {

                                console.log(data.credentials);

                                $('.manual-row').append(data.credentials)
                                imagePreview()
                            }
                        },
                        error: function (xhr, status, error) {
                            // Handle errors here
                            console.error(xhr.responseText);
                        }
                    });
                }
                $('#amount').on('keyup', function (e) {
                    "use strict"
                    var amount = $(this).val()
                    $('.amount').text((Number(amount)))
                    $('.currency').text(currency)
                    var charge = globalData.charge_type === 'percentage' ? calPercentage(amount, globalData.charge) : globalData.charge
                    $('.charge2').text(charge + ' ' + currency)

                    $('.total').text((Number(amount) + Number(charge)) + ' ' + currency)
                })

            


        });
    </script>
    <script>
        // Color Switcher
        $(".color-switcher").on('click', function () {
            "use strict"
            $("body").toggleClass("dark-theme");
            var url = '../theme-mode';
            $.get(url)
        });

    </script>







</body>

</html>